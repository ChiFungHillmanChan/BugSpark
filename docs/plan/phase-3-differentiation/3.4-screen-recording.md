# 3.4 Screen Recording (Video)

## Priority: LOW | Complexity: MEDIUM

Jam.dev and Bird Eats Bug built their products around screen recording. While session replay (3.1) covers DOM-level recording, some users want to record their actual screen including interactions with browser UI, devtools, or multiple tabs.

---

## Feature Scope

- User clicks "Record" in the widget or browser extension
- Records screen (or tab) as video using MediaRecorder API
- Stops recording when user submits bug report
- Video uploaded and attached to bug report
- Dashboard shows video player in bug detail page

## Technical Approach

Use the browser's native `MediaRecorder` API with `getDisplayMedia`:

```typescript
// packages/widget/src/collectors/screen-recorder.ts

class ScreenRecorder {
    private mediaRecorder: MediaRecorder | null = null;
    private chunks: Blob[] = [];

    async start(): Promise<void> {
        const stream = await navigator.mediaDevices.getDisplayMedia({
            video: { mediaSource: 'screen' },
            audio: false,
        });

        this.mediaRecorder = new MediaRecorder(stream, {
            mimeType: 'video/webm;codecs=vp9',
            videoBitsPerSecond: 1000000, // 1 Mbps
        });

        this.mediaRecorder.ondataavailable = (e) => {
            if (e.data.size > 0) this.chunks.push(e.data);
        };

        this.mediaRecorder.start(1000); // Chunk every 1s
    }

    stop(): Blob {
        this.mediaRecorder?.stop();
        this.mediaRecorder?.stream.getTracks().forEach(t => t.stop());
        return new Blob(this.chunks, { type: 'video/webm' });
    }
}
```

**Note:** `getDisplayMedia` requires user permission prompt (browser-enforced). This is different from rrweb session replay which is invisible.

### Upload and Storage

- Max recording: 60 seconds (to keep file sizes manageable)
- Estimated file size: 1-5 MB per 60s at 1 Mbps
- Upload via presigned URL (same pattern as screenshots)
- Store as `.webm` in S3/R2

### Dashboard Player

```typescript
// Simple HTML5 video player
function ScreenRecordingPlayer({ videoUrl }: { videoUrl: string }) {
    return (
        <video controls width="100%" preload="metadata">
            <source src={videoUrl} type="video/webm" />
        </video>
    );
}
```

## Implementation Steps

1. Create `screen-recorder.ts` collector in widget
2. Add "Record Screen" button to widget UI (optional, next to screenshot)
3. Handle `getDisplayMedia` permission flow
4. Upload video via presigned URL
5. Add `screen_recording_url` to Report model
6. Create Alembic migration
7. Add video player to bug detail page
8. Add upload endpoint for video files
9. Validate file type (webm only) and size (max 10MB)

## Plan Gating

| Plan | Screen Recording |
|------|-----------------|
| Free | None |
| Starter | None |
| Pro | 30 seconds |
| Team | 60 seconds |
| Enterprise | 120 seconds |

## Considerations

- Browser compatibility: `getDisplayMedia` is supported in Chrome, Firefox, Edge (not Safari iOS)
- User must explicitly grant screen sharing permission
- This is more intrusive than rrweb session replay
- Consider making this opt-in per project
- Video files are larger than rrweb replay data â€” storage costs are higher
